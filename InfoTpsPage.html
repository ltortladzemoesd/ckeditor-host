<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>InfoTpsPage – Edit Full Document</title>
  <script src="https://cdn.ckeditor.com/4.22.1/standard/ckeditor.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: Arial;
      padding: 40px;
      background: #f5f5f5;
    }
    select, button {
      padding: 10px 20px;
      font-size: 16px;
      margin-right: 10px;
      margin-bottom: 20px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #2c3e50;
      color: white;
      border: none;
      cursor: pointer;
    }
    #editorContainer {
      display: none;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h2>Edit Full Document (Information + TPs)</h2>

  <select id="countryChoice">
    <option value="">-- Select a country --</option>
    <option value="Georgia">Georgia</option>
    <option value="Germany">Germany</option>
    <option value="France">France</option>
    <!-- Add more countries -->
  </select>

  <button id="loadAndEditBtn">Edit Full Document</button>

  <div id="editorContainer">
    <textarea id="editor" rows="20" cols="80"></textarea>
  </div>

  <script>
    // ✅ Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAH6IH8c9imo9xlIoxpjVzVcgVIMqqgR2g",
      authDomain: "ckeditor-content-saver.firebaseapp.com",
      projectId: "ckeditor-content-saver",
      storageBucket: "ckeditor-content-saver.appspot.com",
      messagingSenderId: "429325764295",
      appId: "1:429325764295:web:ef0006899c4461e1afa0e2"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ✅ Section headers
    const sections = {
      Introduction: "Introduction",
      Diplomatic_Relations: "Diplomatic Relations",
      Bilateral_Trade_and_Economic_Relations: "Bilateral Trade and Economic Relations",
      Trade_Policy: "Trade Policy",
      Tourism: "Tourism",
      Investment: "Investment",
      Transport: "Transport",
      Energy: "Energy",
      Communications_Innovation_and_Post: "Communications, Innovation and Post",
      Information_Technology: "Information Technology",
      Remarks: "Remarks"
    };

    // ✅ Button click to load and merge content
    document.getElementById("loadAndEditBtn").addEventListener("click", async () => {
      const country = document.getElementById("countryChoice").value;
      if (!country) return alert("Please select a country");

      let fullHTML = "";
      for (const [key, title] of Object.entries(sections)) {
        const docId = `${country}_${key}_tp`;
        try {
          const doc = await db.collection("ckeditor-content").doc(docId).get();
          const content = (doc.exists && doc.data().content) ? doc.data().content.trim() : "";

          if (content) {
            fullHTML += `
              <h2 style="background:#DEE6E9; padding:10px; border-radius:20px; text-align:center;">${title}</h2>
              ${content}
              <br><br>
            `;
          }
        } catch (err) {
          console.error(`Failed to load ${docId}`, err);
        }
      }

      // Show editor and insert merged content
      document.getElementById("editorContainer").style.display = "block";
      if (CKEDITOR.instances.editor) {
        CKEDITOR.instances.editor.setData(fullHTML);
      } else {
        CKEDITOR.replace("editor", { height: 600 });
        CKEDITOR.instances.editor.setData(fullHTML);
      }
    });
  </script>
</body>
</html>
